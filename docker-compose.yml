# Timestamp (UTC): 2025-12-22T17:35:36Z
services:
  bot:
    build: .
    image: plus500-autotrader:latest
    restart: unless-stopped
    environment:
      BINANCE_API_KEY: ${BINANCE_API_KEY:-}
      BINANCE_API_SECRET: ${BINANCE_API_SECRET:-}
      EMAIL_TO: ${EMAIL_TO:-}
      EMAIL_FROM: ${EMAIL_FROM:-}
      SMTP_HOST: ${SMTP_HOST:-}
      SMTP_PORT: ${SMTP_PORT:-}
      SMTP_USER: ${SMTP_USER:-}
      SMTP_PASS: ${SMTP_PASS:-}
      SMTP_STARTTLS: ${SMTP_STARTTLS:-}
      SMTP_SSL: ${SMTP_SSL:-}
    volumes:
      - ./data/live:/app/data/live
    ports:
      - "127.0.0.1:8000:8000"
    healthcheck:
      test: ["CMD", "python3", "scripts/healthcheck.py", "--port", "8000"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
    command:
      - python3
      - scripts/live_paper_trade_2025-12-20T15-01-14Z.py
      - --mode
      - live
      - --trade-mode
      - auto
      - --gate-window
      - "5"
      - --trade-margin-eur
      - "15"
      - --max-open-real
      - "1"
      - --metrics-port
      - "8000"
      - --health-max-staleness-sec
      - "120"

  dydx_bot:
    build: .
    image: plus500-autotrader:latest
    restart: unless-stopped
    environment:
      DYDX_ENV: ${DYDX_ENV:-mainnet}
      DYDX_MNEMONIC: ${DYDX_MNEMONIC:?set DYDX_MNEMONIC in .env}
      DYDX_ADDRESS: ${DYDX_ADDRESS:-}
      DYDX_NODE_GRPC: ${DYDX_NODE_GRPC:?set DYDX_NODE_GRPC in .env}
      DYDX_INDEXER_REST: ${DYDX_INDEXER_REST:-https://indexer.dydx.trade}
      DYDX_INDEXER_WS: ${DYDX_INDEXER_WS:-wss://indexer.dydx.trade/v4/ws}
      DYDX_MARKET: ${DYDX_MARKET:-BTC-USD}
      DYDX_SUBACCOUNT_TRADING: ${DYDX_SUBACCOUNT_TRADING:-1}
      DYDX_SUBACCOUNT_BANK: ${DYDX_SUBACCOUNT_BANK:-0}
      DYDX_TRADE_FLOOR_USDC: ${DYDX_TRADE_FLOOR_USDC:-10}
      DYDX_PROFIT_SIPHON_FRAC: ${DYDX_PROFIT_SIPHON_FRAC:-0.30}
      DYDX_BANK_THRESHOLD_USDC: ${DYDX_BANK_THRESHOLD_USDC:-280}
      DYDX_LIQUIDATION_RECAP_BANK_FRAC: ${DYDX_LIQUIDATION_RECAP_BANK_FRAC:-0.10}
      DYDX_FEE_SIDE: ${DYDX_FEE_SIDE:-0.001}
      DYDX_MAX_LEVERAGE: ${DYDX_MAX_LEVERAGE:-auto}
      DYDX_USE_MARGIN_FRAC: ${DYDX_USE_MARGIN_FRAC:-1.0}
      DYDX_LEVERAGE_SAFETY_FRAC: ${DYDX_LEVERAGE_SAFETY_FRAC:-1.0}
    volumes:
      - ./data/live_dydx:/app/data/live_dydx
      - ./data/pattern_entry_regressor:/app/data/pattern_entry_regressor:ro
      - ./data/exit_oracle:/app/data/exit_oracle:ro
    ports:
      - "127.0.0.1:8001:8001"
    healthcheck:
      test: ["CMD", "python3", "scripts/healthcheck.py", "--port", "8001"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
    command:
      - python3
      - scripts/live_dydx_v4_btc_usd_2025-12-24T13-14-02Z.py
      - --trade-mode
      - real
      - --yes-really
      - --backfill-hours
      - "96"
      - --entry-model
      - /app/data/pattern_entry_regressor/pattern_entry_regressor_v2_2026-01-02T23-51-17Z.joblib
      - --exit-gap-model
      - /app/data/exit_oracle/exit_oracle_gap_regressor_hold15_2026-01-03T16-13-20Z.joblib
      - --exit-gap-tau
      - "0.10"
      - --exit-gap-min-exit-k
      - "2"
      - --hold-min
      - "15"
      - --target-frac
      - "0.0001"
      - --out-dir
      - /app/data/live_dydx
      - --bank-log
      - /app/data/live_dydx/bank_proof.jsonl
      - --metrics-port
      - "8001"
      - --health-max-staleness-sec
      - "120"
      - --stall-seconds
      - "300"
      - --max-prior-scores
      - "200000"
      - --min-prior-scores
      - "2000"
      - --seed-days
      - "2"
      - --retention-days
      - "0"
