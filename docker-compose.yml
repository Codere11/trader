# Timestamp (UTC): 2025-12-22T17:35:36Z
services:
  # dYdX v4 runners (3 trading subaccounts + 1 shared bank subaccount)

  dydx_btc_buy:
    build: .
    image: plus500-autotrader:latest
    restart: unless-stopped
    environment:
      DYDX_ENV: ${DYDX_ENV:-mainnet}
      DYDX_MNEMONIC: ${DYDX_MNEMONIC:?set DYDX_MNEMONIC in .env}
      DYDX_ADDRESS: ${DYDX_ADDRESS:-}
      DYDX_NODE_GRPC: ${DYDX_NODE_GRPC:?set DYDX_NODE_GRPC in .env}
      DYDX_INDEXER_REST: ${DYDX_INDEXER_REST:-https://indexer.dydx.trade}
      DYDX_INDEXER_WS: ${DYDX_INDEXER_WS:-wss://indexer.dydx.trade/v4/ws}
      DYDX_MARKET: BTC-USD
      DYDX_SUBACCOUNT_TRADING: ${DYDX_SUBACCOUNT_TRADING_BTC_BUY:-1}
      DYDX_SUBACCOUNT_BANK: ${DYDX_SUBACCOUNT_BANK_SHARED:-0}
      DYDX_TRADE_FLOOR_USDC: ${DYDX_TRADE_FLOOR_USDC:-10}
      DYDX_PROFIT_SIPHON_FRAC: ${DYDX_PROFIT_SIPHON_FRAC:-0.30}
      DYDX_BANK_THRESHOLD_USDC: ${DYDX_BANK_THRESHOLD_USDC:-200}
      DYDX_LIQUIDATION_RECAP_BANK_FRAC: ${DYDX_LIQUIDATION_RECAP_BANK_FRAC:-0.10}
      DYDX_FEE_SIDE: ${DYDX_FEE_SIDE:-0.001}
      DYDX_MAX_LEVERAGE: ${DYDX_MAX_LEVERAGE:-auto}
      DYDX_USE_MARGIN_FRAC: ${DYDX_USE_MARGIN_FRAC:-1.0}
      DYDX_LEVERAGE_SAFETY_FRAC: ${DYDX_LEVERAGE_SAFETY_FRAC:-1.0}
    volumes:
      - ./data/live_dydx/btc_buy:/app/data/live_dydx
      - ./data/pattern_entry_regressor:/app/data/pattern_entry_regressor:ro
      - ./data/exit_oracle:/app/data/exit_oracle:ro
      - ./data/seeds:/app/data/seeds:ro
    ports:
      - "127.0.0.1:8001:8001"
    healthcheck:
      test: ["CMD", "python3", "scripts/healthcheck.py", "--port", "8001"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 120s
    command:
      - python3
      - scripts/live_dydx_v4_btc_usd_2025-12-24T13-14-02Z.py
      - --trade-mode
      - real
      - --yes-really
      - --subaccount-trading
      - "${DYDX_SUBACCOUNT_TRADING_BTC_BUY:-1}"
      - --subaccount-bank
      - "${DYDX_SUBACCOUNT_BANK_SHARED:-0}"
      - --backfill-hours
      - "168"
      - --seed-csv
      - /app/data/seeds/dydx_BTC-USD_1MIN_seed_168h.csv
      - --initial-topup-budget-usdc
      - "50"
      - --entry-model
      - /app/data/pattern_entry_regressor/pattern_entry_regressor_v2_2026-01-02T23-51-17Z.joblib
      - --exit-gap-model
      - /app/data/exit_oracle/exit_oracle_gap_regressor_hold15_2026-01-03T16-13-20Z.joblib
      - --exit-gap-tau
      - "0.10"
      - --exit-gap-min-exit-k
      - "2"
      - --hold-min
      - "15"
      - --target-frac
      - "0.0001"
      - --out-dir
      - /app/data/live_dydx
      - --bank-log
      - /app/data/live_dydx/bank_proof.jsonl
      - --metrics-port
      - "8001"
      - --health-max-staleness-sec
      - "120"
      - --stall-seconds
      - "300"
      - --max-prior-scores
      - "200000"
      - --min-prior-scores
      - "2000"
      - --seed-days
      - "2"
      - --retention-days
      - "0"

  dydx_eth_buy:
    build: .
    image: plus500-autotrader:latest
    restart: unless-stopped
    environment:
      DYDX_ENV: ${DYDX_ENV:-mainnet}
      DYDX_MNEMONIC: ${DYDX_MNEMONIC:?set DYDX_MNEMONIC in .env}
      DYDX_ADDRESS: ${DYDX_ADDRESS:-}
      DYDX_NODE_GRPC: ${DYDX_NODE_GRPC:?set DYDX_NODE_GRPC in .env}
      DYDX_INDEXER_REST: ${DYDX_INDEXER_REST:-https://indexer.dydx.trade}
      DYDX_INDEXER_WS: ${DYDX_INDEXER_WS:-wss://indexer.dydx.trade/v4/ws}
      DYDX_MARKET: ETH-USD
      DYDX_SUBACCOUNT_TRADING: ${DYDX_SUBACCOUNT_TRADING_ETH_BUY:-2}
      DYDX_SUBACCOUNT_BANK: ${DYDX_SUBACCOUNT_BANK_SHARED:-0}
      DYDX_TRADE_FLOOR_USDC: ${DYDX_TRADE_FLOOR_USDC:-10}
      DYDX_PROFIT_SIPHON_FRAC: ${DYDX_PROFIT_SIPHON_FRAC:-0.30}
      DYDX_BANK_THRESHOLD_USDC: ${DYDX_BANK_THRESHOLD_USDC:-200}
      DYDX_LIQUIDATION_RECAP_BANK_FRAC: ${DYDX_LIQUIDATION_RECAP_BANK_FRAC:-0.10}
      DYDX_FEE_SIDE: ${DYDX_FEE_SIDE:-0.001}
      DYDX_MAX_LEVERAGE: ${DYDX_MAX_LEVERAGE:-auto}
      DYDX_USE_MARGIN_FRAC: ${DYDX_USE_MARGIN_FRAC:-1.0}
      DYDX_LEVERAGE_SAFETY_FRAC: ${DYDX_LEVERAGE_SAFETY_FRAC:-1.0}
    volumes:
      - ./data/live_dydx/eth_buy:/app/data/live_dydx
      - ./data/entry_regressor_oracle15m_2026-01-04T11-28-38Z:/app/data/entry_regressor_oracle15m_2026-01-04T11-28-38Z:ro
      - ./data/exit_oracle:/app/data/exit_oracle:ro
      - ./data/seeds:/app/data/seeds:ro
    ports:
      - "127.0.0.1:8002:8002"
    healthcheck:
      test: ["CMD", "python3", "scripts/healthcheck.py", "--port", "8002"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 120s
    command:
      - python3
      - scripts/live_dydx_v4_eth_usd_buy_oracle15m_2026-01-05T18-41-03Z.py
      - --trade-mode
      - real
      - --yes-really
      - --subaccount-trading
      - "${DYDX_SUBACCOUNT_TRADING_ETH_BUY:-2}"
      - --subaccount-bank
      - "${DYDX_SUBACCOUNT_BANK_SHARED:-0}"
      - --backfill-hours
      - "168"
      - --seed-csv
      - /app/data/seeds/dydx_ETH-USD_1MIN_seed_168h.csv
      - --initial-topup-budget-usdc
      - "50"
      - --bank-threshold-usdc
      - "${DYDX_BANK_THRESHOLD_USDC:-200}"
      - --entry-model
      - /app/data/entry_regressor_oracle15m_2026-01-04T11-28-38Z/models/entry_regressor_buy_oracle15m_2026-01-04T11-28-38Z.joblib
      - --exit-gap-model
      - /app/data/exit_oracle/exit_oracle_gap_regressor_hold15_2026-01-04T14-57-25Z.joblib
      - --metrics-port
      - "8002"
      - --health-max-staleness-sec
      - "120"
      - --stall-seconds
      - "300"
      - --out-dir
      - /app/data/live_dydx

  dydx_eth_sell:
    build: .
    image: plus500-autotrader:latest
    restart: unless-stopped
    environment:
      DYDX_ENV: ${DYDX_ENV:-mainnet}
      DYDX_MNEMONIC: ${DYDX_MNEMONIC:?set DYDX_MNEMONIC in .env}
      DYDX_ADDRESS: ${DYDX_ADDRESS:-}
      DYDX_NODE_GRPC: ${DYDX_NODE_GRPC:?set DYDX_NODE_GRPC in .env}
      DYDX_INDEXER_REST: ${DYDX_INDEXER_REST:-https://indexer.dydx.trade}
      DYDX_INDEXER_WS: ${DYDX_INDEXER_WS:-wss://indexer.dydx.trade/v4/ws}
      DYDX_MARKET: ETH-USD
      DYDX_SUBACCOUNT_TRADING: ${DYDX_SUBACCOUNT_TRADING_ETH_SELL:-3}
      DYDX_SUBACCOUNT_BANK: ${DYDX_SUBACCOUNT_BANK_SHARED:-0}
      DYDX_TRADE_FLOOR_USDC: ${DYDX_TRADE_FLOOR_USDC:-10}
      DYDX_PROFIT_SIPHON_FRAC: ${DYDX_PROFIT_SIPHON_FRAC:-0.30}
      DYDX_BANK_THRESHOLD_USDC: ${DYDX_BANK_THRESHOLD_USDC:-200}
      DYDX_LIQUIDATION_RECAP_BANK_FRAC: ${DYDX_LIQUIDATION_RECAP_BANK_FRAC:-0.10}
      DYDX_FEE_SIDE: ${DYDX_FEE_SIDE:-0.001}
      DYDX_MAX_LEVERAGE: ${DYDX_MAX_LEVERAGE:-auto}
      DYDX_USE_MARGIN_FRAC: ${DYDX_USE_MARGIN_FRAC:-1.0}
      DYDX_LEVERAGE_SAFETY_FRAC: ${DYDX_LEVERAGE_SAFETY_FRAC:-1.0}
      ETH_SELL_ENTRY_THRESHOLD: ${ETH_SELL_ENTRY_THRESHOLD:-0.39}
    volumes:
      - ./data/live_dydx/eth_sell:/app/data/live_dydx/eth_sell
      - ./data/entry_regressor_oracle15m_sell_ctx120_weighted_oracleentry5m_2026-01-04T22-45-20Z:/app/data/entry_regressor_oracle15m_sell_ctx120_weighted_oracleentry5m_2026-01-04T22-45-20Z:ro
      - ./data/exit_oracle_sell:/app/data/exit_oracle_sell:ro
    ports:
      - "127.0.0.1:8003:8003"
    command:
      - python3
      - scripts/live_dydx_v4_eth_usd_sell_simple_2026-01-08T07-47-09Z.py
      - --trade-mode
      - real
      - --yes-really
      - --subaccount-trading
      - "${DYDX_SUBACCOUNT_TRADING_ETH_SELL:-3}"
      - --subaccount-bank
      - "${DYDX_SUBACCOUNT_BANK_SHARED:-0}"
      - --backfill-hours
      - "24"
      - --entry-threshold
      - "${ETH_SELL_ENTRY_THRESHOLD:-0.39}"
      - --entry-model
      - /app/data/entry_regressor_oracle15m_sell_ctx120_weighted_oracleentry5m_2026-01-04T22-45-20Z/models/entry_regressor_sell_oracle15m_ctx120_weighted_oracleentry5m_2026-01-04T22-45-20Z.joblib
      - --exit-gap-model
      - /app/data/exit_oracle_sell/exit_oracle_gap_regressor_sell_hold15_top10_2026-01-05T12-27-59Z.joblib
      - --hold-min
      - "15"
      - --exit-gap-tau
      - "0.10"
      - --exit-gap-min-exit-k
      - "2"
      - --log-every
      - "60"
      - --out-dir
      - /app/data/live_dydx/eth_sell
